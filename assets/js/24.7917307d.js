(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{183:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[s._m(0),s._v(" "),n("p",[s._v("由于HTTP是无状态的，它并不记录用户的身份，用户将账户与密码发送到服务器后，后台通过校验，但并没有记录状态，于是下一次用户的请求仍需要校验份 为了解决这个问题需要在服务端生成一条包含用户身份的记录，也就是session，在将这条记录发送给用户存储在本地，即cookie，之后用户的请求都会带上这条cookie,若客户端的cookie与服务端的seesion都是一致的，则说明身份验证通过。")]),s._v(" "),s._m(1),s._v(" "),s._m(2),s._v(" "),n("p",[s._v("流程大致过程：")]),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),s._m(5),s._v(" "),n("p",[s._v("有人疑惑的上面不是说jwt校验嘛，怎么没提到jwt 是啥？ 这里就进行补充一下jwt的专业描述：")]),s._v(" "),n("blockquote",[n("p",[s._v("JWT(JSON Web Token),字面意思很好理解，就是Web的JSON令牌。一种通过Web可以安全传递JSON格式信息的机制。优势体量小，防串改，数据相对安全。可以用于客户端到服务器端重要用户数据保持，验证用户签名数据，也可以用于无状态服务的状态保持。，而我们项目要做的事情，就是用户登录后把用户当前操作的企业关系，以及用户id存储起来。通过网关将JWT解密后，有相关业务权限的API调用都是使用JWT中传递过来的参数进行权限校验。也可以"),n("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考JWT简介或者官方网站jwt.io"),n("OutboundLink")],1)])]),s._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JWT 介绍：阮一峰"),n("OutboundLink")],1)])]),s._v(" "),n("blockquote",[n("p",[s._v("点提示："),n("a",{attrs:{href:"https://www.jianshu.com/p/310d307e44c6",target:"_blank",rel:"noopener noreferrer"}},[s._v("token"),n("OutboundLink")],1),s._v("/"),n("a",{attrs:{href:"https://www.jianshu.com/p/310d307e44c6",target:"_blank",rel:"noopener noreferrer"}},[s._v("seesion"),n("OutboundLink")],1),s._v("/"),n("a",{attrs:{href:"https://www.jianshu.com/p/310d307e44c6",target:"_blank",rel:"noopener noreferrer"}},[s._v("cookie"),n("OutboundLink")],1),s._v("/"),n("a",{attrs:{href:"https://blog.csdn.net/qq_35585701/article/details/81393361",target:"_blank",rel:"noopener noreferrer"}},[s._v("localstorage"),n("OutboundLink")],1),s._v(" "),n("a",{attrs:{href:"https://github.com/shieldfy/API-Security-Checklist/blob/master/README-zh.md",target:"_blank",rel:"noopener noreferrer"}},[s._v("开发安全的 API 所需要核对的清单"),n("OutboundLink")],1),s._v("\n示例简介：")])]),s._v(" "),s._m(6),s._v(" "),s._m(7),s._v(" "),s._m(8),s._v(" "),s._m(9),s._m(10),s._v(" "),s._m(11),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._m(15),s._v(" "),s._m(16),s._v(" "),s._m(17),s._m(18),s._v(" "),s._m(19)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"_1-传统的session-cookie-身份验证-seesion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-传统的session-cookie-身份验证-seesion","aria-hidden":"true"}},[this._v("#")]),this._v(" -1.传统的session+cookie 身份验证(Seesion)")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"_2-token身份验证（jwt）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-token身份验证（jwt）","aria-hidden":"true"}},[this._v("#")]),this._v(" -2.token身份验证（JWT）")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("流程图\n"),t("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/2047545-ce2ac0ef75f87a8c..png?imageMogr2/auto-orient/strip%7CimageView2/2/w/552/format/webp",alt:"image"}})])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[t("pre",[t("code",[this._v("    第一次请求时，用户发送账户和密码\n")])])]),this._v(" "),t("li",[t("pre",[t("code",[this._v("    后台校验通过，会生成一个有效性的token,再将token发送给用户\n")])])]),this._v(" "),t("li",[t("pre",[t("code",[this._v("    用户获取到token后，存到本地的cookie或者是localstorage 中\n")])])]),this._v(" "),t("li",[t("pre",[t("code",[this._v("    之后的每次api请求都会将token添加到请求头信息，所有需要校验身份的api都会被校验token若token解析后的数据包含用户信息，则身份验证通过\n")])])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h5",{attrs:{id:"seesion与token校验中-token的优点："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#seesion与token校验中-token的优点：","aria-hidden":"true"}},[this._v("#")]),this._v(" Seesion与token校验中 token的优点：")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("在基于token的认证，token通过请求头传输，而不是把认证信息存储在session或者cookie中。这意味着无状态。你可以从任意一种可以发送HTTP请求的终端向服务器发送请求。")]),this._v(" "),t("li",[this._v("可以避免CSRF攻击")]),this._v(" "),t("li",[this._v("当在应用中进行 session的读，写或者删除操作时，会有一个文件操作发生在操作系统的temp 文件夹下，至少在第一次时。假设有多台服务器并且 session 在第一台服务上创建。当你再次发送请求并且这个请求落在另一台服务器上，session 信息并不存在并且会获得一个“未认证”的响应。我知道，你可以通过一个粘性 session 解决这个问题。然而，在基于 token 的认证中，这个问题很自然就被解决了。没有粘性 session 的问题，因为在每个发送到服务器的请求中这个请求的 token 都会被拦截。")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"登录认证接口认证："}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录认证接口认证：","aria-hidden":"true"}},[this._v("#")]),this._v(" 登录认证接口认证：")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("客户端：")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("在config>index.js配置proxyTable")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("proxyTable"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{attrs:{class:"token string"}},[s._v("'/api'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// '/api':匹配项")]),s._v("\n    target"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'http://127.0.0.1:3000/'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{attrs:{class:"token comment"}},[s._v("//设置你调用的接口域名和端口号 别忘了加http")]),s._v("\n    changeOrigin"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token boolean"}},[s._v("true")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    pathRewrite"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token string"}},[s._v("'^/api'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("''")]),n("span",{attrs:{class:"token comment"}},[s._v("//这里理解成用‘/api’代替target里面的地址，后面组件中我们掉接口时直接用api代替 比如我要调用'http://127.0.0.1:3000/user/add'，直接写‘/api/user/add’即可")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("使用axios进行登录以及验证拦截:拦截器")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("blockquote",[t("p",[this._v("http.js来配置axios拦截器，统一处理所有http请求和响应，就得用上 axios 的拦截器。通过配置http resquest interceptors为http头增加Authorization字段，其内容为Token，通过配置http response interceptors，当后端接口返回401 Unauthorized（未授权），让用户重新登录。")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" axios "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'axios'")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" http "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" axios"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("create")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// timeout:10000,")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// baseURL: '',")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// method: 'post'")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// http request 拦截器")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 每次请求都为http头增加Authorization字段，其内容为Token")]),s._v("\nhttp"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("use")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  config "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" token "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" localStorage"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("getItem")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'token'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("token"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      config"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("headers"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("common"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token string"}},[s._v("'Authorization'")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" token"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("// config.headers['token'] = token")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("config"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" config"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  error "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("reject")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// http response 拦截器")]),s._v("\nhttp"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("interceptors"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("use")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("response "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" data "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//返回状态值是200 即返回数据")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code "),n("span",{attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("200")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" data"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//返回状态值401即跳转到登录页面")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code "),n("span",{attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("401")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    window"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("location"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("href "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'/login'")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// let msg = data.code ? data.msg : `${response.config.headers['method']} : ${data.error}`")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// data.message = msg")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("reject")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" error "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// if (error.response) {")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//   switch (error.response.status) {")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//     case 401:")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//       // 这里写清除token的代码")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//       localStorage.removeItem(token);")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//       router.replace({")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//         path: 'login',")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//         query: {redirect: router.currentRoute.fullPath}//登录成功后跳入浏览的当前页面")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//       })")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//   }")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// }")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// return Promise.reject(error.response.data)")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// if (error.code === 'ECONNABORTED' && error.message.indexOf('timeout') !== -1) {")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//   error.msg = '请求超时，请重试'")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// }")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Promise"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("reject")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("default")]),s._v(" http\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("login.vue登录页面的设计：通过axios 发送账户/密码并接受返回数据token")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("<script>\nexport default {\n  name: 'login',\n  data () {\n    return {\n        loginForm: {\n          name: \"liu\",\n          password: '1234'\n        },\n    }\n  },\n  methods:{\n    login(){\n      this.$http.post('/api/login', this.loginForm).then(res => {\n          localStorage.setItem('token', res)\n          location.replace('/index')\n           console.log(res);\n           \n      })\n      \n      \n    }\n  }\n}\n<\/script>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("服务端：")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("在api.js中进行api校验")]),this._v("\n在数据库中查找用户的信息，如果找到说明用户存在 根据用户的数量来判断判断是否存在即可\n数据检索成功，将用户信息加密为token\n将token返回")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Router"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'express'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" jwt "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'jsonwebtoken'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" retoken "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'./retoken'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" indexController "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'../controllers'")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" router "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("Router")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("//设置跨域")]),s._v("\nrouter"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("all")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'*'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("header")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Access-Control-Allow-Origin"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"*"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("header")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Access-Control-Allow-Headers"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"Content-Type,Content-Length, Authorization, Accept,X-Requested-With"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("header")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Access-Control-Allow-Methods"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{attrs:{class:"token string"}},[s._v('"PUT,POST,GET,DELETE,OPTIONS"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("header")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"Access-Control-Request-Headers:content-type,xfilecategory,xfilename,xfilesize"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("header")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v('"X-Powered-By"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{attrs:{class:"token string"}},[s._v("' 3.2.1'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method"),n("span",{attrs:{class:"token operator"}},[s._v("==")]),n("span",{attrs:{class:"token string"}},[s._v('"OPTIONS"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("send")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token number"}},[s._v("200")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{attrs:{class:"token comment"}},[s._v("/*让options请求快速返回*/")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v("  "),n("span",{attrs:{class:"token function"}},[s._v("next")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("//添加token认证")]),s._v("\nrouter"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("use")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("retoken"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("/**\n * 登录验证:\n * *首先获取提交的用户名和密码\n * *查询数据库是否存在账户名 存在则生成token\n * *\n * */")]),s._v("\nrouter"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("use")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'/login'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'进入登录验证模块'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//登录验证获取前端传来的用户表单用户名和密码参数")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" username "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("username "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" password "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n  \n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//在数据库中查找用户的信息，如果找到说明用户存在 根据用户的数量来判断判断是否存在即可")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//使用数据库查询  User.count({'username': username ,'password':password})")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" count "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("2")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("count "),n("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("//生成秘钥")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" jwtTokenSecret "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'fjJWT'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("//生成token  ")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" userToken "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        username"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        password"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        loginAt"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("+")]),n("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{attrs:{class:"token class-name"}},[s._v("Date")]),s._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("//签发token 指定过期时间2h")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" token "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" jwt"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("sign")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("userToken"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" jwtTokenSecret"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" expiresIn"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'2h'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("json")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        code"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("200")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        data"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" token\n      "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nrouter"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("use")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'/index'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("json")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        code"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("200")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        data"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'henhao'")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("//路由")]),s._v("\nrouter"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("use")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'/user'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("indexController"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("default")]),s._v(" router\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("strong",[this._v("retoken.js token认证")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("mport jwt "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"jsonwebtoken"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" api "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"./unLogin"')]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" unLogin "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" api"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("unLogin\n"),n("span",{attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" method "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("toLowerCase")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" path "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path\n    "),n("span",{attrs:{class:"token comment"}},[s._v("//接口不需要登陆：直接next")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("//判断method类型，并且是否包含path")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("unLogin"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("method"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" unLogin"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("method"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("indexOf")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("path"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("-")]),n("span",{attrs:{class:"token number"}},[s._v("1")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'这个api 不需要验证token的'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v("  "),n("span",{attrs:{class:"token function"}},[s._v("next")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" token "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("headers"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authorization\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// console.log(req.headers)")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//没有token值，返回401")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("//秘钥")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" jwtTokenSecret "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'fjJWT'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("token"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("json")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            code"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("401")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            msg"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'you need login:there is no token'")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[s._v("/**\n     * 解析token是否过期 和是否是正确的token\n     */")]),s._v("\n    jwt"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("verify")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("token"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" jwtTokenSecret"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" decoded"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("log")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'已验证token 是正确的'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" res"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("json")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                code"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("401")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                msg"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" err"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg\n            "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{attrs:{class:"token comment"}},[s._v("// 将携带的信息赋给req.user")]),s._v("\n            req"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" decoded\n            "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("next")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")])])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])])}],!1,null,null,null);t.default=e.exports}}]);